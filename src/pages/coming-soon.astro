---
import Layout from '@layouts/Base.astro';
import Burger from '@components/buttons/Burger.astro';
import HeroKeyLogo from '@images/laguntza-fisioterapia-logo.svg';
import HeroKeyBackground from '@images/jokin.webp';
import LogoIsotipoWhite from '@images/logos/isotipo-white.svg';
import KeepScrolling from '@icons/keep-scrolling.svg';
import { nav } from '@config/nav';
import { getLangFromUrl, useTranslations } from '@i18n/utils';

// Alpine.js for interactivity
const url = Astro.url;
const lang = getLangFromUrl(url);
const t = useTranslations(lang);
---

<Layout>
	<header slot="header">
		<Burger
			id="menuButton"
			color="white"
			class="header-burger"
			aria-label={t('Menua ireki')}
			data-open-label={t('Menua ireki')}
			data-close-label={t('Menua itxi')}
		/>
	</header>
	<div class="coming-soon-outer">
		<div id="logo-mask">
			<section>
				<picture id="hero-key" class="hero-key-picture">
					<img id="hero-key-logo" src={HeroKeyLogo.src} />
					<img
						id="hero-key-background"
						src={HeroKeyBackground.src}
						class="background-image"
					/>
				</picture>
			</section>
		</div>

		<div class="coming-soon-main">
			<div id="when">
				<h1>Uztailak 1</h1>
				<a
					href="https://www.google.com/maps/place//data=!4m2!3m1!1s0xd51b135152ab2b5:0x37b035f3db5c5074?sa=X&ved=1t:8290&ictx=111"
					><h3>Urnieta, Zubitxo Plaza, 3</h3></a
				>
			</div>
		</div>
	</div>

	<footer id="hero-footer" slot="footer" class="coming-soon-footer">
		<LogoIsotipoWhite
			id="logo-see-more"
			class="logo-see-more-img"
			width={128}
			height={128}
		/>
		<p class="hero-footer-label">Ikusi gehiago</p>
		<KeepScrolling class="keep-scrolling-icon" fill="currentColor" />
	</footer>

	<!-- Animated Fullscreen Menu Overlay -->
	<div id="coming-soon-menu-overlay" class="coming-soon-menu-overlay">
		<button
			class="menu-close-btn"
			id="menuCloseBtn"
			aria-label={t('Menua itxi')}
		>
			<span>&times;</span>
		</button>
		<nav class="coming-soon-menu-nav">
			<ul>
				{
					nav.map((navItem, i) => (
						<li
							class="coming-soon-menu-item"
							style={`transition-delay: ${i * 80 + 200}ms`}
						>
							<a href={`/${lang}${navItem.slug}`}>{t(navItem.title)}</a>
						</li>
					))
				}
			</ul>
		</nav>
	</div>
</Layout>

<style>
	.background-image {
		width: 100vw;
		height: 100vh;
		object-fit: cover;
	}

	.hero-key-picture {
		height: 100vh;
		transform: scale(1.25);
		display: block;
		overflow: hidden;
		position: fixed;
	}

	#when {
		color: white;
		opacity: 0;
	}
	#hero-key-logo {
		position: absolute; /* Ensure absolute positioning */
		top: 50%;
		left: 50%;
		transform: translate(-50%, -50%);
		width: 80vw;
		padding: 64px;
	}

	#logo-mask {
		position: fixed;
		top: 0;
		height: 100vh;
		width: 100%;
		background: white;
		mask-image: url('/laguntza-fisioterapia-isotipo-21.svg');
		mask-position: center 55%;
		mask-repeat: no-repeat;
		mask-size: clamp(6000vh, 7500%, 0vh);
	}

	#hero-footer {
		position: fixed;
		margin: auto;
		bottom: var(--s2);
		color: white;
	}

	#when {
		position: fixed;
		bottom: 25%;
		display: flex;
		flex-direction: column;
		align-items: center;
		justify-content: center;
		h3 {
			text-decoration: underline;
		}
	}

	.hero-footer-label {
		text-transform: uppercase;
		letter-spacing: 6px;
		white-space: nowrap;
		text-align: center;
		font-weight: 500;
		font-size: var(--font-size-md);
		text-shadow:
			0 0 2px rgba(255, 255, 255, 0.5),
			0 0 8px #000;
	}

	.coming-soon-main {
		position: fixed;
		display: flex;
		flex-direction: column;
		align-items: center;
		justify-content: space-between;
		height: 100vh;
		padding-left: 5rem;
		padding-right: 5rem;
		padding-top: 4rem;
		padding-bottom: 4rem;
		width: 100%;
	}

	.coming-soon-outer {
		height: 200vh;
		background-color: var(--theme-primary);
	}

	.logo-see-more-img {
		filter: drop-shadow(0 0 2px rgba(255, 255, 255, 0.5))
			drop-shadow(0 0 8px #000);
	}

	.coming-soon-footer {
		display: flex;
		flex-direction: column;
		align-items: center;
		justify-content: center;
		gap: var(--s2);
		left: 50%;
		transform: translateX(-50%);
	}

	@keyframes bounce-pulse {
		0% {
			transform: translateY(0);
			scale: 0.8;
			opacity: 0.8;
		}

		50% {
			transform: translateY(-5px);
			opacity: 1;
			scale: 1;
		}

		100% {
			transform: translateY(0);
			scale: 0.8;
			opacity: 0.8;
		}
	}

	.keep-scrolling-icon {
		--animate-bounce-pulse: bounce-pulse 2s ease-in-out infinite;
		animation: var(--animate-bounce-pulse);
		color: #fff;
		filter: drop-shadow(var(--shadow-2xl));
	}

	.header-burger {
		&:global(.burger) {
			z-index: 1000;
			position: fixed;
			top: var(--s2);
			left: var(--s2);
			display: flex;
		}
	}

	.coming-soon-menu-overlay {
		position: fixed;
		inset: 0;
		z-index: 9999;
		background: var(--theme-primary);
		backdrop-filter: blur(8px);
		display: flex;
		flex-direction: column;
		align-items: center;
		justify-content: center;
		overflow: hidden;
		opacity: 0;
		pointer-events: none;
		transition: opacity 0.4s cubic-bezier(0.4, 2, 0.6, 1);
		display: none;
	}
	.coming-soon-menu-overlay.open {
		opacity: 1;
		pointer-events: auto;
	}

	.menu-close-btn {
		position: absolute;
		top: 2rem;
		right: 2rem;
		background: none;
		border: none;
		color: #fff;
		font-size: 2.5rem;
		cursor: pointer;
		z-index: 10001;
		transition: transform 0.2s;
	}
	.menu-close-btn:hover {
		transform: scale(1.15) rotate(8deg);
	}

	.coming-soon-menu-nav ul {
		list-style: none;
		padding: 0;
		margin: 0;
		display: flex;
		flex-direction: column;
		align-items: center;
		gap: 2.5rem;
	}

	.coming-soon-menu-item {
		opacity: 0;
		transform: translateY(40px) scale(0.95);
		transition:
			opacity 0.4s cubic-bezier(0.4, 2, 0.6, 1),
			transform 0.4s cubic-bezier(0.4, 2, 0.6, 1);
	}
	.coming-soon-menu-overlay.open .coming-soon-menu-item {
		opacity: 1;
		transform: translateY(0) scale(1);
	}

	.coming-soon-menu-item a {
		font-size: 2.5rem;
		color: #fff;
		text-decoration: none;
		font-weight: 700;
		letter-spacing: 0.08em;
		text-shadow:
			0 2px 24px #000,
			0 0 2px #fff;
		transition: color 0.2s;
	}
	.coming-soon-menu-item a:hover {
		color: var(--theme-secondary);
		text-shadow:
			0 2px 32px var(--theme-secondary),
			0 0 2px #fff;
	}
</style>

<script>
	import { gsap } from 'gsap';
	import { ScrollTrigger } from 'gsap/ScrollTrigger';

	gsap.registerPlugin(ScrollTrigger);

	const tl = gsap.timeline({
		ease: 'power2.out',
		scrollTrigger: {
			scrub: 1,
		},
	});

	tl.to('#hero-key', { duration: 1, scale: 1.25 })
		.to('#hero-key-logo', { opacity: 0 }, '<')
		.to('#hero-footer', { opacity: 0 }, '<')

		.to('#hero-play-button', { opacity: 0 }, '<')

		.to(
			'#logo-mask',
			{
				maskSize: 'clamp(20vh, 25%, 30vh)',
			},
			0.15,
		)

		.to(
			'#hero-key',
			{
				opacity: 0,
				duration: 0.2,
			},
			0.4,
		)
		.to('#logo-mask', { maskPosition: '50% 25%' }, '<')

		.to('#when', { opacity: 1 }, '<')
		.to('#when', { y: 80 }, '<');
</script>
