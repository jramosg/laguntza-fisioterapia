---
import Layout from '@layouts/Page.astro';

import {
	getLangFromUrl,
	getStaticLangPaths,
	useTranslations,
} from '@i18n/utils';
import Container from '@components/core/Container.astro';
import Chip from '@components/Chip.astro';
import { Langs } from '@i18n/ui';
import Jokin from '@images/jokin.webp';
import Picture from 'astro/components/Picture.astro';
import CircleCheck from '@icons/circle-check.svg';
import Interview from '@images/interview.jpg';
import Prevention from '@images/prevention.jpg';
import Rehab from '@images/rehab.jpg';
import Puncture from '@images/puncture.jpg';
import SectionHero from '@components/SectionHero.astro';
import { generateSlug } from '@utils/helpers';
import Button from '@components/buttons/Button.astro';

export function getStaticPaths() {
	return getStaticLangPaths();
}
const lang: Langs = getLangFromUrl(Astro.url);
console.log('lang', lang);
const t = useTranslations(lang);
const servicesContent = {
	eu: {
		intro:
			'Zerbitzu guztiak fisioterapeuta espezializatu batek eskaintzen ditu, paziente bakoitzaren egoera helburu eta beharretara egokituz.',
		sections: [
			{
				id: 'assessment-diagnosis',
				title: 'Balorazio eta Diagnostiko Pertsonalizatua',
				desc: `Balorazio eta diagnostiko funtzionala zerbitzu guztien abiapuntua da. Paziente bakoitzari elkarrizketa, azterketa kliniko eta proba espezifikoak egiten dizkiogu, arazoaren jatorria eta egoera zehatza identifikatzeko. Horrela, tratamendu eta ariketa programak guztiz pertsonalizatuak diseinatzen ditugu.`,
			},
			{
				id: 'exercise-prevention',
				title: 'Ariketa eta Prebentzio Programak',
				desc: `Adin, egoera eta jarduera fisiko guztietako pertsonei egokitutako ariketa saioak eskaintzen ditugu, osasuna mantentzeko, gaitasun fisikoa hobetzeko edo lesioak prebenitzeko.`,
				bullets: [
					{
						title: 'Adin luzeekoei zuzendutako ariketa programak',
						desc: 'Indarra, oreka eta autonomia mantentzeko, fragilitatea prebenitzeko eta bizi-kalitatea hobetzeko.',
					},
					{
						title: 'Prebentziora zuzendutako ariketak',
						desc: 'Lesioak saihesteko, osasuna mantentzeko eta gaitasun fisikoa hobetzeko ariketak.',
					},
				],
			},
			{
				id: 'rehab-readaptation',
				title: 'Errehabilitazio eta erreadaptazioa',
				desc: `Lesio, ebakuntza edo gaixotasun baten ondoren gaitasun funtzionala eta autonomia berreskuratzeko tratamendua. Helburua pertsona bere jarduera fisiko edo kirol mailara itzultzea. Indarra, koordinazioa eta segurtasuna lantzen dira, lesioak berriro agertzea saihesteko. Prozesu hau ere guztiz pertsonalizatua da.`,
			},
			{
				id: 'specialized-techniques',
				title: 'Teknika Espezializatuak',
				desc: '',
				bullets: [
					{
						title: 'Terapia manuala',
						desc: 'Eskuzko teknika espezializatuak, artikulazio, muskulu eta nerbio sistemaren funtzionamendua hobetzeko, mina arintzeko eta mugimendua berreskuratzeko. Tratamendu bakoitza pazientearen beharretara egokituta eskaintzen dugu.',
					},
					{
						title: 'Osteopatia',
						desc: 'Gorputzaren oreka eta funtzio egokia berreskuratzeko esku bidezko tratamendu integrala, ikuspegi holistikoarekin eta pertsonalizazio osoz.',
					},
					{
						title: 'Puntzio lehorra',
						desc: 'Muskuluetako tentsio eta min puntuak tratatzeko teknika inbaditzailea, orratz finak erabiliz puntu miofaszialak askatzeko eta mina arintzeko. Beti balorazio pertsonalizatuaren arabera aplikatzen da.',
					},
					{
						title: 'Neuromodulazioa',
						desc: 'Sistema nerbiosoaren jarduera erregulatzeko teknika aurreratuak, mina eta disfuntzio neurologikoak arintzeko. Neuromodulazio perkutaneoa, besteak beste, elektroestimulazioa erabiliz egiten da, eta mugimenduaren eta funtzioaren hobekuntza bilatzen du, pazientearen egoerara egokituta.',
					},
				],
			},
		],
	},
	es: {
		title: 'Servicios',
		intro:
			'Todos los servicios son realizados por un fisioterapeuta especializado, adaptándose a la situación, objetivos y necesidades de cada paciente.',
		sections: [
			{
				id: 'assessment-diagnosis',
				title: 'Valoración y Diagnóstico Personalizado',
				desc: `La valoración y el diagnóstico funcional son el punto de partida de todos nuestros servicios. Realizamos una entrevista, exploración clínica y pruebas específicas a cada paciente para identificar el origen del problema y su situación concreta. Así, diseñamos tratamientos y programas de ejercicio totalmente personalizados.`,
			},
			{
				id: 'exercise-prevention',
				title: 'Programas de Ejercicio y Prevención',
				desc: `Ofrecemos sesiones de ejercicio adaptadas a personas de cualquier edad, condición y nivel de actividad física, para mantener la salud, mejorar la capacidad física o prevenir lesiones.`,
				bullets: [
					{
						title: 'Programas de ejercicio para personas mayores',
						desc: 'Para mantener la fuerza, el equilibrio y la autonomía, prevenir la fragilidad y mejorar la calidad de vida.',
					},
					{
						title: 'Ejercicios orientados a la prevención',
						desc: 'Actividades diseñadas para evitar lesiones, mantener la salud y mejorar la condición física.',
					},
				],
			},
			{
				id: 'rehab-readaptation',
				title: 'Rehabilitación y Readaptación',
				desc: `Tratamientos personalizados para recuperar la capacidad funcional y la autonomía tras una lesión, intervención quirúrgica o enfermedad. El objetivo es que la persona pueda volver a su actividad física o deportiva habitual. Se trabajan la fuerza, la coordinación y la seguridad para evitar recaídas. Este proceso también es completamente personalizado.`,
			},
			{
				id: 'specialized-techniques',
				title: 'Técnicas Especializadas',
				desc: '',
				bullets: [
					{
						title: 'Terapia manual y osteopatía',
						desc: 'Técnicas para mejorar el funcionamiento de las articulaciones, músculos y sistema nervioso, aliviar el dolor y recuperar el movimiento. La osteopatía ofrece un enfoque holístico para recuperar el equilibrio y la función corporal, siempre con personalización.',
					},
					{
						title: 'Punción seca',
						desc: 'Técnica invasiva para tratar puntos de tensión y dolor muscular, utilizando agujas finas para liberar puntos miofasciales y aliviar el dolor. Siempre se aplica según una valoración personalizada.',
					},
					{
						title: 'Neuromodulación',
						desc: 'Técnicas avanzadas para regular la actividad del sistema nervioso, aliviar el dolor y tratar disfunciones neurológicas. La neuromodulación percutanea, entre otras, se realiza mediante electroestimulación y busca mejorar el movimiento y la función, adaptándose a la situación del paciente.',
					},
				],
			},
		],
	},
};

const sectionImages = {
	'assessment-diagnosis': Interview,
	'exercise-prevention': Prevention,
	'rehab-readaptation': Rehab,
	'specialized-techniques': Puncture,
};

const content = servicesContent[lang];
---

<Layout>
	<SectionHero id="services-hero">
		{
			lang === 'eu' ? (
				<h1 slot="title">
					Gure <span class="hero-section__remark">fisioterapia</span> zerbitzuak
				</h1>
			) : (
				<h1 slot="title">
					Nuestros servicios de{' '}
					<span class="hero-section__remark">fisioterapia</span>
				</h1>
			)
		}
		<Fragment slot="desc">
			{servicesContent[lang].intro}
		</Fragment>
		<div slot="chips" class="carousel">
			<div class="group">
				{
					servicesContent[lang].sections.map(service => {
						const hash = generateSlug(service.title);
						return <Chip href={`#${hash}`} text={service.title} />;
					})
				}
			</div>
			<div aria-hidden="true" class="group">
				{
					servicesContent[lang].sections.map(service => {
						const hash = generateSlug(service.title);
						return <Chip href={`#${hash}`} text={service.title} />;
					})
				}
			</div>
		</div>
	</SectionHero>
	<Container class="services-grid" tag="section">
		{
			content.sections.map((section, idx) => {
				const hash = generateSlug(section.title);
				const isEven = idx % 2 === 0;
				const image =
					sectionImages[section.id as keyof typeof sectionImages] || Jokin;
				return (
					<section
						class:list={[
							'service-card',
							'card',
							'card--elevated',
							isEven ? 'even-service' : 'odd-service',
						]}
						id={hash}
					>
						<Picture
							src={image}
							alt="Jokin Ramos"
							id="home-hero-image"
							class="service-card__image"
						/>
						<div class="service-card__desc">
							<h2>{section.title}</h2>
							<p>{section.desc}</p>
							{section.bullets?.length && (
								<ul>
									{section.bullets?.map(bullet => {
										return (
											<li class="service-card__bullet">
												<CircleCheck color="currentColor" />
												<div>
													<h3>{bullet.title}</h3>
													{bullet.desc && (
														<>
															<p>{bullet.desc}</p>
														</>
													)}
												</div>
											</li>
										);
									})}
								</ul>
							)}
						</div>
					</section>
				);
			})
		}
	</Container>
	<Button class="services-cta" href={`/${lang}/contact`}>
		{t('Harremanetan jarri informazio geihago lortzeko')}
	</Button>
</Layout>

<style>
	ul {
		margin: 0;
		padding: 0;
	}
	li {
		list-style: none;
	}

	.services-list__container {
		display: flex;
		flex-direction: column;
		gap: 2.5em;
	}

	.service-card {
		display: flex;
		flex-direction: column;
		position: relative;
		scroll-margin-top: var(--header-height);
		align-items: stretch;
	}
	.service-card:hover {
		z-index: 2;
	}

	.service-card__desc {
		padding: var(--s6);

		h2 {
			font-size: var(--font-size-md);
		}

		p {
			color: var(--theme-text-secondary);
		}
	}

	.services-cta {
		margin: var(--s6) 0;
		margin-left: auto;
		margin-right: auto;
	}

	.services-cta__btn:hover {
		background: var(--theme-primary-hover);
	}

	.services-grid {
		display: grid;
		gap: var(--s7);
		margin-top: var(--s5);
	}

	.service-card {
		display: grid;
		gap: var(--s6);
		align-items: stretch;
	}

	.service-card__image {
		height: 100%;
		width: 100%;
		object-fit: cover;
	}

	.service-card__image {
		border-top-right-radius: var(--theme-shape-radius);
		border-top-left-radius: var(--theme-shape-radius);
	}

	@media (min-width: 1024px) {
		.service-card {
			grid-template-columns: repeat(2, minmax(0, 1fr));
			grid-auto-flow: column dense;
			align-items: stretch;
		}
		.service-card__image {
			height: 100%;
			max-height: none;
			aspect-ratio: 1/1;
			object-fit: cover;
		}
		.service-card__desc {
			height: 100%;
		}
		.odd-service .service-card__image {
			grid-column-start: 2;
		}

		.odd-service .service-card__desc {
			grid-column-start: 1;
		}

		.even-service .service-card__image {
			border-top-left-radius: var(--theme-shape-radius);
			border-bottom-left-radius: var(--theme-shape-radius);
			border-top-right-radius: unset;
		}
		.odd-service .service-card__image {
			border-top-right-radius: var(--theme-shape-radius);
			border-bottom-right-radius: var(--theme-shape-radius);
			border-top-left-radius: unset;
		}
	}

	.service-card__bullet {
		margin: var(--s2) 0;
		display: grid;
		grid-template-columns: 1fr auto;
		gap: var(--s2);
		svg {
			color: var(--theme-primary);
			margin-top: 4px;
		}

		h3 {
			font-size: var(--font-size-base);
			line-height: normal;
			margin: unset;
		}

		p {
			font-weight: unset;
		}
	}

	.group[aria-hidden='true'] {
		display: none;
	}
	@media (max-width: 768px) {
		.carousel {
			margin: 0 auto;
			padding: 20px 0;
			max-width: 700px;
			overflow: hidden;
			display: flex;
			> * {
				flex: 0 0 100%;
			}
			&:hover .group {
				animation-play-state: paused;
			}
		}
		.group {
			gap: var(--s2);
			display: flex;
			/* Add padding to the right to create a gap between the last and first card. */
			padding-right: var(--s2);
			will-change: transform;
			animation: scrolling 10s linear infinite;
		}
		.group[aria-hidden='true'] {
			display: flex;
		}
	}

	@keyframes scrolling {
		0% {
			transform: translateX(0);
		}
		100% {
			transform: translateX(-100%);
		}
	}
</style>

<script>
	import { gsap } from 'gsap';
	import { ScrollTrigger } from 'gsap/ScrollTrigger';
	gsap.registerPlugin(ScrollTrigger);

	document.addEventListener('astro:page-load', () => {
		const cards = document.querySelectorAll('.service-card');
		cards.forEach(card => {
			const desc = card.querySelector('.service-card__desc');
			if (!desc) return;

			const heading = desc.querySelector('h2');
			const paragraph = desc.querySelector('p');
			const targets = [heading, paragraph].filter(Boolean);

			const tl = gsap.timeline({
				ease: 'power2.out',
				scrollTrigger: {
					trigger: card,
					start: 'top 70%',
					toggleActions: 'play none none none',
				},
			});

			if (targets.length) {
				tl.fromTo(
					targets,
					{
						opacity: 0,
						y: 60,
						scale: 0.96,
						filter: 'blur(6px)',
					},
					{
						opacity: 1,
						y: 0,
						scale: 1,
						filter: 'blur(0px)',
						duration: 0.2,
						ease: 'power3.out',
						stagger: 0.08,
					},
				);
			}

			const bullets = desc.querySelectorAll('.service-card__bullet');
			const tlB = gsap.timeline({
				ease: 'power2.out',
				scrollTrigger: {
					trigger: card,
					start: 'top 50%',
					toggleActions: 'play none none none',
				},
			});
			bullets.forEach(bullet => {
				tlB.from(
					bullet,
					{
						opacity: 0,
						y: 30,
						filter: 'blur(4px)',
						duration: 0.2,
					},
					'>',
				);
			});
		});
	});
</script>
